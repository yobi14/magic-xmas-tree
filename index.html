<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>粒子圣诞树</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at top, #02111d, #000);
    overflow: hidden;
    touch-action: none;
}
canvas {
    display: block;
}
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let W, H;
function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const particles = [];
const TREE_HEIGHT = 420;
const TREE_WIDTH = 260;
const COUNT = 1200;

const centerX = () => W / 2;
const baseY = () => H * 0.8;

let touch = { x: -9999, y: -9999 };

document.addEventListener("mousemove", e => {
    touch.x = e.clientX;
    touch.y = e.clientY;
});
document.addEventListener("touchmove", e => {
    touch.x = e.touches[0].clientX;
    touch.y = e.touches[0].clientY;
}, { passive: false });
document.addEventListener("touchend", () => {
    touch.x = touch.y = -9999;
});

class Particle {
    constructor() {
        this.reset();
        this.x = Math.random() * W;
        this.y = Math.random() * H;
    }

    reset() {
        const t = Math.random();
        const y = baseY() - t * TREE_HEIGHT;
        const halfWidth = (1 - t) * TREE_WIDTH * 0.5;
        const x = centerX() + (Math.random() * 2 - 1) * halfWidth;

        this.tx = x;
        this.ty = y;
        this.x = x + (Math.random() - 0.5) * 200;
        this.y = y + (Math.random() - 0.5) * 200;

        this.size = Math.random() * 2 + 1;
        this.phase = Math.random() * Math.PI * 2;
        this.colorOffset = Math.random() * 360;
    }

    update() {
        const dx = this.tx - this.x;
        const dy = this.ty - this.y;
        this.x += dx * 0.05;
        this.y += dy * 0.05;

        const distX = this.x - touch.x;
        const distY = this.y - touch.y;
        const dist = Math.sqrt(distX * distX + distY * distY);
        if (dist < 120) {
            this.x += distX * 0.05;
            this.y += distY * 0.05;
        }

        this.phase += 0.03;
    }

    draw() {
        const glow = Math.sin(this.phase) * 0.5 + 0.5;
        ctx.beginPath();
        ctx.fillStyle = `hsla(${this.colorOffset + this.y * 0.2},100%,70%,${0.6 + glow})`;
        ctx.arc(this.x, this.y, this.size + glow * 1.5, 0, Math.PI * 2);
        ctx.fill();
    }
}

for (let i = 0; i < COUNT; i++) {
    particles.push(new Particle());
}

function drawStar() {
    ctx.save();
    ctx.translate(centerX(), baseY() - TREE_HEIGHT - 30);
    ctx.rotate(Date.now() * 0.002);
    ctx.fillStyle = "gold";
    ctx.beginPath();
    for (let i = 0; i < 5; i++) {
        ctx.lineTo(0, -20);
        ctx.translate(0, -20);
        ctx.rotate((Math.PI * 2) / 10);
        ctx.lineTo(0, 20);
        ctx.translate(0, 20);
        ctx.rotate(-(Math.PI * 6) / 10);
    }
    ctx.fill();
    ctx.restore();
}

function animate() {
    ctx.clearRect(0, 0, W, H);

    particles.forEach(p => {
        p.update();
        p.draw();
    });

    drawStar();
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
