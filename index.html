<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>âœ¨ TikTok é­”æ³•åœ£è¯æ ‘ âœ¨</title>
    <style>
        body { margin: 0; background: radial-gradient(circle at center, #0a0a1a 0%, #000 100%); overflow: hidden; font-family: 'Montserrat', sans-serif; color: #fff; }
        canvas { position: absolute; top: 0; left: 0; display: block; }
        
        #video { 
            position: absolute; bottom: 10px; right: 10px; width: 150px; height: 112px; 
            border-radius: 12px; border: 3px solid rgba(255,255,255,0.4); 
            transform: scaleX(-1); /* é•œåƒç¿»è½¬ */
            opacity: 0.2; /* è°ƒè¯•æ—¶å¯è§ï¼Œä¸Šçº¿å¯è®¾ä¸º 0 */
            z-index: 5;
        }
        
        #status { 
            position: absolute; top: 20px; width: 100%; text-align: center;
            font-size: 1.3rem; text-shadow: 0 0 15px #0ff, 0 0 20px #0ff;
            color: #e0ffff; z-index: 10;
        }
        #hint {
            position: absolute; bottom: 20px; width: 100%; text-align: center;
            font-size: 0.9rem; color: rgba(255,255,255,0.7); z-index: 10;
            opacity: 1; transition: opacity 0.5s ease-out;
        }
        #hint.hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div id="status">æ­£åœ¨åŠ è½½é­”æ³•ï¼Œè¯·ç­‰å¾…...</div>
    <div id="hint">ğŸ™Œ è¯·åœ¨ HTTPS æˆ– localhost ç¯å¢ƒä¸‹è¿è¡Œï¼Œå¹¶ä¼¸å‡ºé£ŸæŒ‡ã€‚</div>
    <video id="video" playsinline></video>
    <canvas id="canvas"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('canvas');
        const canvasCtx = canvasElement.getContext('2d');
        const statusText = document.getElementById('status');
        const hintText = document.getElementById('hint');

        let width, height;
        let particles = [];
        let fingerX = -1000, fingerY = -1000; // é»˜è®¤å€¼åœ¨å±å¹•å¤–
        let isFingerDetected = false;
        
        const PARTICLE_COUNT = 6000; // æ›´å¤šç²’å­ï¼Œæ›´å¯†
        const INTERACTION_RADIUS = 120; // æ‰‹æŒ‡äº’åŠ¨èŒƒå›´
        const METEOR_COUNT = 5; // èƒŒæ™¯æµæ˜Ÿæ•°é‡
        const SNOWFLAKE_COUNT = 50; // é›ªèŠ±æ•°é‡

        // å“åº”å¼ç”»å¸ƒå¤§å°
        function resize() {
            width = canvasElement.width = window.innerWidth;
            height = canvasElement.height = window.innerHeight;
            initParticles(); // é‡æ–°åˆå§‹åŒ–ç²’å­ä½ç½®
        }
        window.addEventListener('resize', resize);
        resize();

        // ====== ç²’å­ç³»ç»Ÿ ======
        class Particle {
            constructor(x, y, baseColor) {
                this.x = x;
                this.y = y;
                this.baseColor = baseColor; // åˆå§‹é¢œè‰²
                this.currentSize = Math.random() * 2 + 1; // ç²’å­å¤§å°
                this.targetSize = this.currentSize;
                this.opacity = Math.random() * 0.4 + 0.6; // åˆå§‹é€æ˜åº¦
                this.speed = Math.random() * 0.05 + 0.01; // é—ªçƒé€Ÿåº¦
                this.brightnessBoost = 0; // å—æ‰‹æŒ‡å½±å“çš„äº®åº¦æå‡
                this.colorBoost = 0; // å—æ‰‹æŒ‡å½±å“çš„é¢œè‰²å˜åŒ–
            }

            draw() {
                // è·ç¦»æ‰‹æŒ‡çš„äº’åŠ¨
                const dx = fingerX - this.x;
                const dy = fingerY - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (isFingerDetected && distance < INTERACTION_RADIUS) {
                    const impact = (1 - distance / INTERACTION_RADIUS);
                    this.brightnessBoost = Math.min(this.brightnessBoost + impact * 0.2, 1.5); // å¿«é€Ÿå¢äº®
                    this.colorBoost = Math.min(this.colorBoost + impact * 0.1, 1); // é¢œè‰²å˜åŒ–
                } else {
                    this.brightnessBoost *= 0.9; // ç¼“æ…¢è¡°å‡
                    this.colorBoost *= 0.95;
                }

                // åŸºç¡€é—ªçƒ
                const baseBrightness = Math.sin(Date.now() * this.speed + this.x) * 0.3 + 0.7; // 0.4 åˆ° 1 ä¹‹é—´
                let finalBrightness = Math.min(baseBrightness + this.brightnessBoost, 2);

                // é¢œè‰²æ··åˆ (ä»åŸºç¡€è‰²åˆ°ç™½è‰²/é‡‘è‰²/é’è‰²)
                const baseRGB = hexToRgb(this.baseColor);
                let r = baseRGB.r + (255 - baseRGB.r) * this.colorBoost;
                let g = baseRGB.g + (255 - baseRGB.g) * this.colorBoost * 0.8; // ç»¿è‰²å°‘å˜ä¸€ç‚¹
                let b = baseRGB.b + (255 - baseRGB.b) * this.colorBoost * 0.5; // è“è‰²å°‘å˜ä¸€ç‚¹
                
                // ç²’å­ç»˜åˆ¶
                canvasCtx.beginPath();
                canvasCtx.arc(this.x, this.y, this.currentSize, 0, Math.PI * 2);
                canvasCtx.fillStyle = `rgba(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)}, ${this.opacity * finalBrightness})`;
                
                canvasCtx.shadowBlur = 5 + finalBrightness * 10; // äº®åº¦è¶Šé«˜ï¼Œå…‰æ™•è¶Šå¼º
                canvasCtx.shadowColor = `rgba(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)}, ${this.opacity * finalBrightness})`;
                canvasCtx.fill();
                canvasCtx.shadowBlur = 0; // é‡ç½®é˜´å½±ï¼Œé¿å…å½±å“ä¸‹ä¸€ä¸ª
            }
        }

        // åˆå§‹åŒ–æ‰€æœ‰ç²’å­
        function initParticles() {
            particles = [];
            const treeHeight = Math.min(height * 0.7, 600);
            const centerX = width / 2;
            const bottom = height * 0.85; // æ ‘åº•éƒ¨ä½ç½®

            // ç”Ÿæˆæ ‘å¶ç²’å­ (åˆ†å±‚ä¸‰è§’å½¢ï¼Œé¢œè‰²æ›´ä¸°å¯Œ)
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                let x, y, baseColor;

                // ç¡®ä¿ç²’å­åœ¨æ ‘å½¢èŒƒå›´å†…
                do {
                    const rY = Math.random(); // 0åˆ°1çš„éšæœºé«˜åº¦æ¯”
                    const h = rY * treeHeight; // ç²’å­ç›¸å¯¹äºæ ‘åº•çš„é«˜åº¦
                    const maxWidth = (1 - (h / treeHeight) * 0.5) * (treeHeight * 0.6); // æ ‘é¡¶çª„åº•éƒ¨å®½

                    x = centerX + (Math.random() - 0.5) * 2 * maxWidth;
                    y = bottom - h - (Math.random() * 20); // éšæœºå°åç§»è®©è¾¹ç¼˜æ›´è‡ªç„¶
                    
                    // æ ‘å¹²çš„ç²’å­
                    if (y > bottom - 50 && Math.abs(x - centerX) < 40) {
                        baseColor = '#3e2723';
                    } else {
                        // éšæœºé¢œè‰²ï¼šç»¿è‰²ç³»ã€é‡‘è‰²ã€çº¢è‰²ã€è“è‰²ï¼ˆæ¨¡æ‹Ÿå½©ç¯ï¼‰
                        const rand = Math.random();
                        if (rand < 0.7) { // ç»¿è‰²ç³»
                            baseColor = `hsl(${100 + Math.random() * 40}, 100%, ${30 + Math.random() * 20}%)`;
                        } else if (rand < 0.85) { // é‡‘è‰²/é»„è‰²
                            baseColor = `hsl(${40 + Math.random() * 20}, 100%, ${60 + Math.random() * 20}%)`;
                        } else if (rand < 0.95) { // çº¢è‰²/ç²‰è‰²
                            baseColor = `hsl(${340 + Math.random() * 20}, 100%, ${60 + Math.random() * 20}%)`;
                        } else { // è“è‰²/é’è‰²
                            baseColor = `hsl(${200 + Math.random() * 40}, 100%, ${60 + Math.random() * 20}%)`;
                        }
                    }
                } while (y > bottom + 50 || y < bottom - treeHeight - 50 || !isInsideRoughTreeShape(x, y, centerX, treeHeight, bottom));
                
                particles.push(new Particle(x, y, baseColor));
            }
        }

        // åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨å¤§è‡´çš„åœ£è¯æ ‘å½¢çŠ¶å†… (æ›´ç²¾ç¡®)
        function isInsideRoughTreeShape(px, py, centerX, height, bottom) {
            if (py > bottom + 50 || py < bottom - height - 50) return false;
            
            const relativeY = bottom - py; // ä»åº•éƒ¨å¾€ä¸Š
            // æ ‘å½¢ä»åº•éƒ¨åˆ°é¡¶éƒ¨é€æ¸å˜çª„
            const currentWidthHalf = (height - relativeY) / height * (centerX * 0.6) + 20; // é¡¶éƒ¨æœ€å°å®½åº¦20
            
            return px > centerX - currentWidthHalf && px < centerX + currentWidthHalf;
        }

        // è¾…åŠ©å‡½æ•°ï¼šHEX è½¬ RGB
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        // ====== èƒŒæ™¯æµæ˜Ÿ ======
        let meteors = [];
        class Meteor {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height; // ä»å±å¹•ä¸Šæ–¹éšæœºä½ç½®ç”Ÿæˆ
                this.length = Math.random() * 100 + 50;
                this.speed = Math.random() * 10 + 5;
                this.angle = Math.PI / 4; // æ–œå‘ä¸‹
                this.color = `hsl(${Math.random() * 60 + 200}, 100%, 70%)`; // è“ç™½è‰²
            }

            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;

                if (this.y > height + this.length || this.x > width + this.length) {
                    this.reset();
                }
            }

            draw() {
                canvasCtx.beginPath();
                canvasCtx.moveTo(this.x, this.y);
                canvasCtx.lineTo(this.x - Math.cos(this.angle) * this.length, this.y - Math.sin(this.angle) * this.length);
                canvasCtx.strokeStyle = this.color;
                canvasCtx.lineWidth = 2;
                canvasCtx.shadowBlur = 15;
                canvasCtx.shadowColor = this.color;
                canvasCtx.stroke();
                canvasCtx.shadowBlur = 0;
            }

            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height - this.length;
            }
        }
        function initMeteors() {
            for (let i = 0; i < METEOR_COUNT; i++) {
                meteors.push(new Meteor());
            }
        }

        // ====== é›ªèŠ±æ•ˆæœ ======
        let snowflakes = [];
        class Snowflake {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.radius = Math.random() * 3 + 1;
                this.speedX = (Math.random() - 0.5) * 1.5; // å·¦å³æ¼‚ç§»
                this.speedY = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.7 + 0.3;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (this.y > height) {
                    this.y = -this.radius; // ä»é¡¶éƒ¨é‡æ–°å‡ºç°
                    this.x = Math.random() * width;
                }
                if (this.x > width || this.x < 0) {
                    this.x = Math.random() * width; // é‡æ–°å‡ºç°
                }
            }

            draw() {
                canvasCtx.beginPath();
                canvasCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                canvasCtx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                canvasCtx.fill();
            }
        }
        function initSnowflakes() {
            for (let i = 0; i < SNOWFLAKE_COUNT; i++) {
                snowflakes.push(new Snowflake());
            }
        }

        // é¡¶éƒ¨å¤§æ˜Ÿæ˜Ÿ
        function drawMainStar() {
            const starX = width / 2;
            const starY = height * 0.85 - Math.min(height * 0.7, 600) - 40;
            canvasCtx.save();
            canvasCtx.shadowBlur = 30 + Math.sin(Date.now() * 0.005) * 15; // å‘¼å¸å¼é—ªçƒ
            canvasCtx.shadowColor = "gold";
            canvasCtx.font = "60px serif";
            canvasCtx.textAlign = "center";
            canvasCtx.fillText("â­", starX, starY);
            canvasCtx.restore();
        }

        // ====== ä¸»åŠ¨ç”»å¾ªç¯ ======
        function animate() {
            canvasCtx.fillStyle = 'rgba(0, 0, 0, 0.15)'; // æ‹–å°¾æ•ˆæœï¼Œå‡å°‘æ—§å¸§ç—•è¿¹
            canvasCtx.fillRect(0, 0, width, height);

            drawMainStar();
            particles.forEach(p => p.draw());

            meteors.forEach(m => {
                m.update();
                m.draw();
            });

            snowflakes.forEach(s => {
                s.update();
                s.draw();
            });

            requestAnimationFrame(animate);
        }

        // ====== Mediapipe æ‰‹åŠ¿è¯†åˆ« ======
        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1, // åªæ£€æµ‹ä¸€åªæ‰‹
            modelComplexity: 1,
            minDetectionConfidence: 0.7, // æé«˜ç½®ä¿¡åº¦ï¼Œå‡å°‘è¯¯è§¦
            minTrackingConfidence: 0.7
        });

        hands.onResults(onResults);

        function onResults(results) {
            isFingerDetected = false;
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const indexFingerTip = results.multiHandLandmarks[0][8]; // é£ŸæŒ‡å°–
                fingerX = (1 - indexFingerTip.x) * width; // ç¿»è½¬ X è½´ä»¥åŒ¹é…å®é™…
                fingerY = indexFingerTip.y * height;
                isFingerDetected = true;
                statusText.innerText = "âœ¨ é­”æ³•å·²è¿æ¥ï¼ç”¨é£ŸæŒ‡ç‚¹äº®åœ£è¯æ ‘ï¼";
                hintText.classList.add('hidden'); // éšè—æç¤º
            } else {
                fingerX = -1000; // ç§»å‡ºå±å¹•å¤–
                fingerY = -1000;
                statusText.innerText = "ğŸ™Œ è¯·å°†é£ŸæŒ‡å¯¹å‡†æ‘„åƒå¤´ã€‚";
                hintText.classList.remove('hidden'); // æ˜¾ç¤ºæç¤º
            }
        }

        // å¯åŠ¨æ‘„åƒå¤´
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 640,
            height: 480
        });

        // ç›‘å¬æ‘„åƒå¤´å¯åŠ¨çŠ¶æ€
        camera.start().then(() => {
            statusText.innerText = "ğŸŒŸ æ‘„åƒå¤´å·²å¯åŠ¨ï¼è¯·å°†é£ŸæŒ‡å¯¹å‡†æ‘„åƒå¤´ã€‚";
            initParticles();
            initMeteors();
            initSnowflakes();
            animate(); // å¯åŠ¨åŠ¨ç”»
        }).catch(err => {
            statusText.innerText = "ğŸš« æ‘„åƒå¤´å¯åŠ¨å¤±è´¥æˆ–æµè§ˆå™¨æƒé™ä¸è¶³ã€‚è¯·æ£€æŸ¥ï¼šæ˜¯å¦åœ¨ HTTPS/localhost ç¯å¢ƒï¼Ÿæ˜¯å¦å…è®¸äº†æ‘„åƒå¤´ï¼Ÿ";
            hintText.classList.remove('hidden');
            console.error("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:", err);
            // å³ä½¿æ‘„åƒå¤´å¤±è´¥ï¼Œä¹Ÿå¯åŠ¨åŠ¨ç”»ï¼Œåªæ˜¯æ²¡æœ‰æ‰‹åŠ¿äº’åŠ¨
            initParticles();
            initMeteors();
            initSnowflakes();
            animate();
        });

    </script>
</body>
</html>